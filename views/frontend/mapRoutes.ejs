<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" name="viewport">
  <title>Rutas | Mobile We-Search</title>

  <!-- css -->
  <link href="../css/base.css" rel="stylesheet">
  <link href="../css/project.css" rel="stylesheet">
  <!--<link href="../css/360box.css" rel="stylesheet" type="text/css" >-->
  <link href="../css/box360.css" rel="stylesheet" type="text/css" >
  <!--hover effect-->
  <link rel="stylesheet" type="text/css" href="../css/eHover.css">
  <!--Circlar carousel-->
  <link rel="stylesheet" type="text/css" href="../circularCarousel/css/style.css" >
  <link rel="stylesheet" type="text/css" href="../circularCarousel/css/jquery.jscrollpane.css" media="all">
  <!--Modal-->
  <link href="../css/modal.css" rel="stylesheet" type="text/css">
  <!--Fonts-->
  <link rel="stylesheet" type="text/css" href="../Fonts/font-awesome/css/font-awesome.css">
  <link rel="stylesheet" type="text/css" href="../Fonts/ionicons/css/ionicons.css">
 
  <!-- ... -->
</head>
<body class="page-red">
  <header class="header header-transparent header-waterfall ui-header">
    <ul class="nav nav-list pull-left">
      <li>
        <a data-toggle="menu" href="#ui_menu">
          <span class="icon icon-lg">menu</span>
        </a>
      </li>
    </ul>
    <a class="header-logo margin-left-no" href="/">We-Search</a>
    
    <!--<ul class="nav nav-list pull-right">
      <li class="dropdown margin-right">
        <a class="dropdown-toggle padding-left-no padding-right-no" data-toggle="dropdown">
          <span class="access-hide">John Smith</span>
          <span class="avatar avatar-sm"><img alt="alt text for John Smith avatar" src="../images/users/avatar-001.jpg"></span>
        </a>
        <ul class="dropdown-menu dropdown-menu-right">
          <li>
            <a class="padding-right-lg waves-attach" href="javascript:void(0)"><span class="icon icon-lg margin-right">account_box</span>login</a>
          </li>
       </ul>
      </li>
    </ul>-->
  </header>
  
  <nav aria-hidden="true" class="menu" id="ui_menu" tabindex="-1">
    <div class="menu-scroll">
      <div class="menu-content">
        <a class="menu-logo" href="/">We-Search</a>
        <ul class="nav">
          <li>
            <a class="collaosed waves-attach" data-toggle="collapse" href="#ui_menu_components">Calle</a>
          </li>
          <li>
            <a class="collapsed waves-attach" data-toggle="collapse" href="#ui_menu_extras">Entretenimiento</a>
          </li>
          <li>
            <a class="collapsed waves-attach" data-toggle="collapse" href="#ui_menu_javascript">Ocio</a>
          </li>
          <li>
            <a class="collapsed waves-attach" data-toggle="collapse" href="#ui_menu_samples">Cultura</a>
          </li>
          <li>
            <a class="collapsed waves-attach" href="/rutas">Cómo llegar</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  
  <main class="content">
    <div class="content-header ui-content-header">
      <div class="container">
        <div class="row">
          <div class="col-lg-6 col-lg-push-3 col-sm-10 col-sm-push-1">
            <h1 class="content-heading"></h1> 
          </div>
        </div>
      </div>
    </div>
    
    <div class="container">

      <!--Contenido de la vista-->
      <div class="ui-card-wrap">
        <div id="floating-panel" style="position: inherit;">
          <b>Establecimiento: </b>
          <select id="end">
            <option value="5.5325988, -73.3637375">Escoja uno</option>
            <% if (Establishment) { %>
            <% Establishment.forEach(function(Estab) { %>
              <option value="<%= Estab.latitude %>, <%= Estab.longitude %>"><%= Estab.name %></option>
            <% }); %>
            <% } else { %>
              <option value="5.539293, -73.3912607">No hay establecimientos registrados</option>
            <% } %>
          </select>
          <b>Modo de desplazamiento: </b>
          <select id="mode">
            <option value="DRIVING">Conduciendo</option>
            <option value="WALKING">Caminando</option>
          </select>
        </div>
        <div id="map" style="height:460px; width:100%;"></div>
        <div id="warnings-panel"></div>
      </div>
    </div>
  </main>

  <footer class="ui-footer">
    <div class="container">
      <strong>&copy; 2016 <a href="">We-nnova</a> - Todos los derechos reservados</strong>
    </div>
  </footer>
  <div class="fbtn-container">
    <div class="fbtn-inner">
      <a class="fbtn fbtn-lg fbtn-brand-accent waves-attach waves-circle waves-light" data-toggle="dropdown"><span class="fbtn-text fbtn-text-left">Links</span><span class="fbtn-ori icon">apps</span><span class="fbtn-sub icon">close</span></a>
      <div class="fbtn-dropup">
        <a class="fbtn waves-attach waves-circle" href="#" target="_blank"><span class="fbtn-text fbtn-text-left">Fork me on GitHub</span><span class="icon">code</span></a>
        <a class="fbtn fbtn-brand waves-attach waves-circle waves-light" href="#" target="_blank"><span class="fbtn-text fbtn-text-left">Follow Daemon on Twitter</span><span class="icon">share</span></a>
        <a class="fbtn fbtn-green waves-attach waves-circle" href="#" target="_blank"><span class="fbtn-text fbtn-text-left">Visit Daemon Website</span><span class="icon">link</span></a>
      </div>
    </div>
  </div>

  <div id="modal-window">
    <div class="modal-window-content">
      <div class="modal-header">
        <h4>Titulo de la imagen</h4>
        <a href="#" id="closed"><i class="fa fa-close"></i></a>
      </div>
      
      <div class="copy">
        <div class="description">
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dignissimos necessitatibus provident expedita vel sit corrupti cumque officia explicabo voluptatibus rerum doloremque voluptatem error tenetur maxime nihil, velit obcaecati possimus dolorum!</p>  
        </div>
        <div class="picture">
          <div id="content">
            <div id="container"></div>
              <p style="text-align: center;">
                <a href="#" id="go"><img class="loading360" src="./images/Logos/3601.png"></a>
              </p>

          </div>
        </div>
      </div>
    </div>
    <div class="overlay"></div>
  </div>
 
  <!-- js -->
  <script src="../js/jquery.min.js"></script>
  <script src="../js/jQuery-2.2.0.min.js"></script>
  <script src="../js/base.min.js"></script>
  <script src="../js/project.min.js"></script>
  <!--Score-->
  <script src="../js/score.js"></script>
  <!--circular Carousel-->
  <script type="text/javascript" src="../circularCarousel/js/jquery.js"></script>
  <script type="text/javascript" src="../circularCarousel/js/jquery.easing.1.3.js"></script>
  <script type="text/javascript" src="../circularCarousel/js/jquery.mousewheel.js"></script>
  <script type="text/javascript" src="../circularCarousel/js/jquery.contentcarousel.js"></script>

  <script type="text/javascript">
      $('#ca-container').contentcarousel();
  </script>

  <script type="text/javascript">
  var nc = jQuery.noConflict();
  nc(document).ready(function() {
      <!--alert("Si salgo es que no hay conflicto!!!");-->
  });
  </script>
    
  <!-- Google maps scripts -->
  <script type="text/javascript">
    function initMap() {
      var markerArray = [];
      var pos = {
        lat: 0,
        lng: 0
      };
      // Instantiate a directions service.
      var directionsService = new google.maps.DirectionsService;
      // Create a map and center it on Manhattan.
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 13,
        center: {lat: 5.5325988, lng: -73.3637375}
      });
      var infoWindow = new google.maps.InfoWindow({map: map});
      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          pos.lat = position.coords.latitude;
          pos.lng = position.coords.longitude;
          infoWindow.setPosition(pos);
          infoWindow.setContent('Usted está aquí');
          map.setCenter(pos);
        }, function() {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
      // Create a renderer for directions and bind it to the map.
      var directionsDisplay = new google.maps.DirectionsRenderer({map: map});
      // Instantiate an info window to hold step text.
      var stepDisplay = new google.maps.InfoWindow;
      // Display the route between the initial start and end selections.
      calculateAndDisplayRoute(directionsDisplay, directionsService, markerArray, stepDisplay, map, pos);
      // Listen to change events from the start and end lists.
      var onChangeHandler = function() {
        calculateAndDisplayRoute(directionsDisplay, directionsService, markerArray, stepDisplay, map, pos);
      };
      // If the selected end o mode (Destino, modo de desplazamiento) is changed by the user...
      document.getElementById('end').addEventListener('change', onChangeHandler);
      document.getElementById('mode').addEventListener('change', onChangeHandler);
    }
    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
                            'Error: The Geolocation service failed.' :
                            'Error: Your browser doesn\'t support geolocation.');
    }
    function calculateAndDisplayRoute(directionsDisplay, directionsService,
        markerArray, stepDisplay, map, actualPos) {
      // First, remove any existing markers from the map.
      for (var i = 0; i < markerArray.length; i++) {
        markerArray[i].setMap(null);
      }
      // Retrieve the start and end locations and create a DirectionsRequest using
      // WALKING directions.
      directionsService.route({
        origin: actualPos,
        destination: document.getElementById('end').value,
        travelMode: document.getElementById('mode').value
      }, function(response, status) {
        // Route the directions and pass the response to a function to create
        // markers for each step.
        if (status === google.maps.DirectionsStatus.OK) {
          document.getElementById('warnings-panel').innerHTML =
              '<b>' + response.routes[0].warnings + '</b>';
          directionsDisplay.setDirections(response);
          //showSteps(response, markerArray, stepDisplay, map);
        } else {
          window.alert('Directions request failed due to ' + status);
        }
      });
    }
    /*function showSteps(directionResult, markerArray, stepDisplay, map) {
      // For each step, place a marker, and add the text to the marker's infowindow.
      // Also attach the marker to an array so we can keep track of it and remove it
      // when calculating new routes.
      var myRoute = directionResult.routes[0].legs[0];
      for (var i = 0; i < myRoute.steps.length; i++) {
        var marker = markerArray[i] = markerArray[i] || new google.maps.Marker;
        marker.setMap(map);
        marker.setPosition(myRoute.steps[i].start_location);
        attachInstructionText(
            stepDisplay, marker, myRoute.steps[i].instructions, map);
      }
    }*/
    function attachInstructionText(stepDisplay, marker, text, map) {
      google.maps.event.addListener(marker, 'click', function() {
        // Open an info window when the marker is clicked on, containing the text
        // of the step.
        stepDisplay.setContent(text);
        stepDisplay.open(map, marker);
      });
    }
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBc4vXDL2yJ-yX3ac14z8Mnwpgs1eiSHYg&signed_in=true&callback=initMap"></script>
</body>
</html>