<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" name="viewport">
  <title>MobileWe-Search</title>

  <!-- css -->
  <link href="../css/base.css" rel="stylesheet">
  <link href="../css/project.css" rel="stylesheet">
  <!--<link href="../css/360box.css" rel="stylesheet" type="text/css" >-->
  <link href="../css/box360.css" rel="stylesheet" type="text/css" >
  <!--hover effect-->
  <link rel="stylesheet" type="text/css" href="../css/eHover.css">
  <!--Circlar carousel-->
  <link rel="stylesheet" type="text/css" href="../circularCarousel/css/style.css" >
  <link rel="stylesheet" type="text/css" href="../circularCarousel/css/jquery.jscrollpane.css" media="all">
  <!--Modal-->
  <link href="../css/modal.css" rel="stylesheet" type="text/css">
  <!--Fonts-->
  <link rel="stylesheet" type="text/css" href="../Fonts/font-awesome/css/font-awesome.css">
  <link rel="stylesheet" type="text/css" href="../Fonts/ionicons/css/ionicons.css">
   <!--Photo Sphere-->
  <link href="Photo-Sphere/example1.css" rel="stylesheet" type="text/css"/>
  <!--Photo Sphere-->
  <script type="text/javascript" src="Photo-Sphere/js/example1.js"></script>
  <script type="text/javascript" src="Photo-Sphere/js/photo-sphere-viewer.js"></script>
  <script type="text/javascript" src="Photo-Sphere/js/photo-sphere-viewer.min.js"></script>
  <script type="text/javascript" src="Photo-Sphere/js/three.min.js"></script>
  <!--Photo Sphere-->
  <link href="../Photo-Sphere/example1.css" rel="stylesheet" type="text/css"/>
  
  <!-- ... -->
</head>
<body class="page-red">
  <header class="header header-transparent header-waterfall ui-header">
    <ul class="nav nav-list pull-left">
      <li>
        <a data-toggle="menu" href="#ui_menu">
          <span class="icon icon-lg">menu</span>
        </a>
      </li>
    </ul>
    <a class="header-logo margin-left-no" href="/"><img class="logotipo" src="../images/logos/We-Search.png"></a>
    
    <!--<ul class="nav nav-list pull-right">
      <li class="dropdown margin-right">
        <a class="dropdown-toggle padding-left-no padding-right-no" data-toggle="dropdown">
          <span class="access-hide">John Smith</span>
          <span class="avatar avatar-sm"><img alt="alt text for John Smith avatar" src="../images/users/avatar-001.jpg"></span>
        </a>
        <ul class="dropdown-menu dropdown-menu-right">
          <li>
            <a class="padding-right-lg waves-attach" href="javascript:void(0)"><span class="icon icon-lg margin-right">account_box</span>login</a>
          </li>
       </ul>
      </li>
    </ul>-->
  </header>
  <nav aria-hidden="true" class="menu" id="ui_menu" tabindex="-1">
    <div class="menu-scroll">
      <div class="menu-content">
        <a class="menu-logo" href="/"><img class="logotipo" src="../images/logos/We-Search-color.png"></a>
        <ul class="nav">
          <li>
            <a class="collaosed waves-attach" href="../calle">Calle</a>
          </li>
          <li>
            <a class="collapsed waves-attach" href="../ocio">Ocio</a>
          </li>
          <li>
            <a class="collapsed waves-attach" href="../cultura">Cultura</a>
          </li>
          <li>
            <a class="collapsed waves-attach" href="/rutas">Cómo llegar</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <main class="content">
    <div class="content-header ui-content-header">
      <div class="container">
        <div class="row">
          <div class="col-lg-6 col-lg-push-3 col-sm-10 col-sm-push-1">
            <h1 class="content-heading"></h1> 
          </div>
        </div>
      </div>
    </div>
    
    <div class="container">

    <!--Cntenido de la vista-->
    <div class="ui-card-wrap">
          <div class="row">
              <div class="card">
                <aside class="card-side card-side-img pull-left">
                  <img alt="alt text" src="../images/category/<%= Establishment.idcategory%>/<%= Establishment._id%>/2.jpg">

                  <span>
                       
                        <div class="quali">
                            <a id="QualiVal">
                            <%= Establishment.score%>
                          </a>
                          <a id="<%= Establishment._id%>" class="positive-cal qualify"><i class="fa fa-certificate"></i></a>
                        </div>

                      
                    </span>
                </aside>
                <div class="card-main">
                  <div class="card-inner">
                    <p class="card-heading titulo-establecimiento"><%= Establishment.name%></p>
                    <p class="margin-bottom-lg">
                      <%= Establishment.description %> 
                    </p>
                  </div>
                  <div class="card-action">
                  <ul class="pull-right">
                    <div class="Social-icons">
                      <a href="#routeMap" class="btn btn-social-icon"><img src="../images/logos/gmaps.png"></a>
                      <a class="btn btn-social-icon btn-facebook"><i class="fa fa-facebook-f"></i></a>
                      <a class="btn btn-social-icon btn-google"><i class="fa fa-google-plus"></i></a>
                      <a class="btn btn-social-icon btn-instagram"><i class="fa fa-instagram"></i></a>
                      <a class="btn btn-social-icon btn-twitter"><i class="fa fa-twitter"></i></a>
                    </div>
                  </ul>
                  </div>
                </div>
              </div>
            
          </div>
    </div>
    
    <% if (Establishment.status != "0") {%>
    <div class="ui-card-wrap">
          <div class="row">
          
          <div id="ca-container" class="ca-container">
            <div class="ca-wrapper">
              
            <% Product.forEach(function(Product) { %> 
              <div class="ca-item">
                <div class="ca-item-main">
                  <div class="product">
                    <img class="imag-product" src="../images/category/<%= Establishment.idcategory%>/<%= Establishment._id%>/<%= Product._id%>/1.jpg">
                  </div>
                    <a href="#" class="ca-more">leer mas...</a>
                </div>
                <div class="ca-content-wrapper">
                  <div class="ca-content">
                    <h6><%= Product.name%></h6>
                    <a href="#" class="ca-close">close</a>
                    <div class="ca-content-text">
                      <p><%= Product.description%></p>
                    </div>
                  </div>
                </div>
              </div>
              <% }) %>
      <!--ca-wrapper close-->
          </div>
        </div>
      </div>
    </div>
    <% if (Establishment.status === "2") {%>
    <div class="ui-card-wrap">
          <div class="row">
           <% Photo.forEach(function(Photo) { %> 
            <section>
              <div class="box box-danger">
                <div class="box-header with-border">
                  <h3 class="box-title"><%= Photo.name%></h3>
                    <div class="box-tools pull-right">
                      <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                      </button>
                    </div>
                  <!-- /.box-tools -->
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                  <a href="#modal-window">
                  <img src="../images/360/<%= Establishment._id%>/<%= Photo._id%>/1.jpg" id="image">
                  </a>
                </div>
                <!-- /.box-body -->
              </div>
              <!-- /.box -->
          </section>
          <% })%>
        <% }%>
      <% }%> 
      </div>
    </div>

    
    <!-- Ruta en el mapa -->
    <section id="routeMap">
      <h3>Como llegar a <b><%= Establishment.name %></b></h3>
      <b>Modo de desplazamiento: </b>
      <select id="mode">
        <option value="WALKING">Caminando</option>
        <option value="DRIVING">Conduciendo</option>
      </select>

      <div id="map" style="height:500px; width:100%;"></div>
    </section>

    </div>
  </main>
  <footer class="ui-footer">
    <div class="container">
      <strong>&copy; 2016 <a href="">We-nnova</a> - Todos los derechos reservados</strong>
    </div>
  </footer>
  <div class="fbtn-container">
    <div class="fbtn-inner">
      <a class="fbtn fbtn-lg fbtn-brand-accent waves-attach waves-circle waves-light" data-toggle="dropdown"><span class="fbtn-text fbtn-text-left">Links</span><span class="fbtn-ori icon">apps</span><span class="fbtn-sub icon">close</span></a>
      <div class="fbtn-dropup">
        <a class="fbtn waves-attach waves-circle" href="#" target="_blank"><span class="fbtn-text fbtn-text-left">Fork me on GitHub</span><span class="icon">code</span></a>
        <a class="fbtn fbtn-brand waves-attach waves-circle waves-light" href="#" target="_blank"><span class="fbtn-text fbtn-text-left">Follow Daemon on Twitter</span><span class="icon">share</span></a>
        <a class="fbtn fbtn-green waves-attach waves-circle" href="#" target="_blank"><span class="fbtn-text fbtn-text-left">Visit Daemon Website</span><span class="icon">link</span></a>
      </div>
    </div>
  </div>

   <div id="modal-window">
      <div class="modal-window-content">
        <div class="modal-header">
          <h4>Titulo de la imagen</h4>
          <a href="#" id="closed"><i class="fa fa-close"></i></a>
        </div>
        
        <div class="copy">
          <div class="description">
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dignissimos necessitatibus provident expedita vel sit corrupti cumque officia explicabo voluptatibus rerum doloremque voluptatem error tenetur maxime nihil, velit obcaecati possimus dolorum!</p>  
          </div>

          <div class="picture">
            <div id="content">
              <div id="container"></div>
                <p style="text-align: center;">
                <a href="" id="go"><img class="loading360" src="images/logos/3601.png"><img id="Back-image" class="Back-image"src=""></a>
                
                <!--<a href="" id="go"></a>--> 
                </p>
            </div>
          </div>
          
        </div>
      </div>
      <div class="overlay"></div>
  </div>

  <!--Photo Sphere-->
<script type="text/javascript" src="../Photo-Sphere/js/example1.js"></script>
<script type="text/javascript" src="../Photo-Sphere/js/photo-sphere-viewer.js"></script>
<script type="text/javascript" src="../Photo-Sphere/js/photo-sphere-viewer.min.js"></script>
<script type="text/javascript" src="../Photo-Sphere/js/three.min.js"></script>
 
  <!-- js -->
  <script src="../js/jquery.min.js"></script>
  <script src="../js/base.min.js"></script>
  <script src="../js/project.min.js"></script>
  <!--Score-->
  <script src="../js/score.js"></script>
  <!--circular Carousel-->
  <script type="text/javascript" src="../circularCarousel/js/jquery.js"></script>
  <script type="text/javascript" src="../circularCarousel/js/jquery.easing.1.3.js"></script>
  <script type="text/javascript" src="../circularCarousel/js/jquery.mousewheel.js"></script>
  <script type="text/javascript" src="../circularCarousel/js/jquery.contentcarousel.js"></script>
  <!--Collapsable-->
  <script type="text/javascript">
      $('#ca-container').contentcarousel();
  </script>

  <script type="text/javascript">
  $(document).ready(function(){
    $("#go").click(function(){
      $("#go").fadeOut("slow");
    });
  });
</script>

<script type="text/javascript">
  var imagen=document.getElementById('image').src ;
   document.getElementById('Back-image').src=imagen;
</script>

    <script type="text/javascript">
  var nc = jQuery.noConflict();
  nc(document).ready(function() {
      <!--alert("Si salgo es que no hay conflicto!!!");-->
  });
  </script>
    
  <!-- Google maps scripts -->
  <script>
    function initMap() {
      var directionsDisplay = new google.maps.DirectionsRenderer;
      var directionsService = new google.maps.DirectionsService;

      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 14,
        //center: {lat: 5.5336665, lng: -73.3586349}
      });
      directionsDisplay.setMap(map);

      var infoWindow = new google.maps.InfoWindow({map: map});

      var pos = {
        lat: 0,
        lng: 0
      };

      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        // Capture coordinates of actual position
        navigator.geolocation.getCurrentPosition(function(position) {
          pos.lat = position.coords.latitude;
          pos.lng = position.coords.longitude;

          infoWindow.setPosition(pos);
          infoWindow.setContent('Su localización actual');
          map.setCenter(pos);

          // Actual position (pos) is sent to calculate route
          calculateAndDisplayRoute(directionsService, directionsDisplay, pos);
          document.getElementById('mode').addEventListener('change', function() {
            calculateAndDisplayRoute(directionsService, directionsDisplay, pos);
          });

        }, function() {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
                            'Error: The Geolocation service failed.' :
                            'Error: Your browser doesn\'t support geolocation.');
    }

    function calculateAndDisplayRoute(directionsService, directionsDisplay, actualPos) {
      var selectedMode = document.getElementById('mode').value;
      // Set route values
      directionsService.route({
        origin: actualPos,
        destination: {lat: parseFloat('<%= Establishment.latitude %>'), lng: parseFloat('<%= Establishment.longitude %>')},
        // Note that Javascript allows us to access the constant
        // using square brackets and a string value as its
        // "property."
        travelMode: google.maps.TravelMode[selectedMode]
      }, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
          directionsDisplay.setDirections(response);
        } else {
          window.alert('La generación de la ruta ha fallado. Error: ' + status);
        }
      });
    }
  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key= AIzaSyBc4vXDL2yJ-yX3ac14z8Mnwpgs1eiSHYg&callback=initMap">
  </script>
</body>
</html>